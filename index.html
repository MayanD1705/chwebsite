<!DOCTYPE html>
<html lang="en">

<head>
  <title>Critical Hit</title>
  <link rel="icon" type="image/x-icon" href="imgs/criticalHitLogo.ico">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    /*body {
      font-family: "Lato", sans-serif
    }*/

    @font-face {
      font-family: 'Jersey25';
      src: url('Jersey25-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    body,
    html,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    * {
      font-family: 'Jersey25', sans-serif;
    }

    .mySlides {
      display: none
    }

    .slideshow-gradient {
      overflow: hidden;
      width: 100%;
    }

    .slideshow-gradient-bg {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      z-index: 0;
      border-radius: inherit;
      /* Example: Black to transparent upwards, adjust as needed */
      background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 75%, rgba(0, 0, 0, 0.0) 100%);
    }

    .slideshow-gradient>*:not(.slideshow-gradient-bg) {
      position: relative;
      z-index: 1;
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <div class="w3-top">
    <div class="w3-bar w3-purple w3-card">
      <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)"
        onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
      <a href="#" class="w3-bar-item w3-button w3-padding-large">Home</a>
      <a href="#info" class="w3-bar-item w3-button w3-padding-large w3-hide-small">Info</a>
      <a href="#events" class="w3-bar-item w3-button w3-padding-large w3-hide-small">Events</a>
      <!--a href="#begin" class="w3-bar-item w3-button w3-padding-large w3-hide-small">Smash Beginner's Guide</a-->
      <!--div class="w3-dropdown-hover w3-hide-small">
      <button class="w3-padding-large w3-button" title="More">MORE <i class="fa fa-caret-down"></i></button>     
      <div class="w3-dropdown-content w3-bar-block w3-card-4">
        <a href="#" class="w3-bar-item w3-button">Merchandise</a>
        <a href="#" class="w3-bar-item w3-button">Extras</a>
        <a href="#" class="w3-bar-item w3-button">Media</a>
      </div>
    </div>
    <a href="javascript:void(0)" class="w3-padding-large w3-hover-red w3-hide-small w3-right"><i class="fa fa-search"></i></a-->
    </div>
  </div>

  <!-- Navbar on small screens (remove the onclick attribute if you want the navbar to always show on top of the content when clicking on the links) -->
  <div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
    <a href="#info" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">Info</a>
    <a href="#events" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">Events</a>
    <!--a href="#begin" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">Smash Beginner's Guide</a-->
  </div>

  <!-- Page content -->
  <div class="w3-content" style="max-width:2000px;margin-top:46px">

    <!-- Automatic Slideshow Images -->
    <div class="mySlides w3-display-container w3-center">
      <img src="imgs/room.jpg" style="width:100%">
      <div class="w3-display-bottommiddle w3-container w3-text-white w3-padding-32 w3-hide-small slideshow-gradient">
        <div class="slideshow-gradient-bg"></div>
        <img src="imgs/criticalHitLogo.png" style="width:35%">
        <h3><b>Canterbury's Local Smash Bros Tourney & Casual Video Game Meetup</b></h3>
        <h2><b>FRESHERS EVENT:</b></h2>
        <h3><b><i class="fa fa-clock-o w3-hover-opacity"></i> Thursday (2 Oct) 4pm to 9pm</b></h3>
        <!--h3><b>Weekly Time: <i class="fa fa-clock-o w3-hover-opacity"></i> Sundays 12pm to 5pm</b></h3-->
        <h3><b><a href="#location"><i class="fa fa-map-marker w3-hover-opacity"></i> Kennedy Seminar Room 2, University
              of Kent</a></b></h3>
      </div>
    </div>
    <div class="mySlides w3-display-container w3-center">
      <img src="imgs/main.jpg" style="width:100%">
      <div class="w3-display-bottommiddle w3-container w3-text-white w3-padding-32 w3-hide-small slideshow-gradient">
        <div class="slideshow-gradient-bg"></div>
        <img src="imgs/criticalHitLogo.png" style="width:35%">
        <h3><b>Canterbury's Local Smash Bros Tourney & Casual Video Game Meetup</b></h3>
        <h2><b>FRESHERS EVENT:</b></h2>
        <h3><b><i class="fa fa-clock-o w3-hover-opacity"></i> Thursday (2 Oct) 4pm to 9pm</b></h3>
        <!--h3><b>Weekly Time: <i class="fa fa-clock-o w3-hover-opacity"></i> Sundays 12pm to 5pm</b></h3-->
        <h3><b><a href="#location"><i class="fa fa-map-marker w3-hover-opacity"></i> Kennedy Seminar Room 2, University
              of Kent</a></b></h3>
      </div>
    </div>
    <div class="mySlides w3-display-container w3-center">
      <img src="imgs/eff.jpg" style="width:100%">
      <div class="w3-display-bottommiddle w3-container w3-text-white w3-padding-32 w3-hide-small slideshow-gradient">
        <div class="slideshow-gradient-bg"></div>
        <img src="imgs/criticalHitLogo.png" style="width:35%">
        <h3><b>Canterbury's Local Smash Bros Tourney & Casual Video Game Meetup</b></h3>
        <h2><b>FRESHERS EVENT:</b></h2>
        <h3><b><i class="fa fa-clock-o w3-hover-opacity"></i> Thursday (2 Oct) 4pm to 9pm</b></h3>
        <!--h3><b>Weekly Time: <i class="fa fa-clock-o w3-hover-opacity"></i> Sundays 12pm to 5pm</b></h3-->
        <h3><b><a href="#location"><i class="fa fa-map-marker w3-hover-opacity"></i> Kennedy Seminar Room 2, University
              of Kent</a></b></h3>
      </div>
    </div>

    <!-- The Info Section -->
    <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="info">
      <div class="w3-hide-large w3-hide-medium">
        <img src="imgs/criticalHitLogo.png" style="width:35%">
        <h3><b>Canterbury's Local Smash Bros Tourney & Casual Video Game Meetup</b></h3>
        <h2><b>FRESHERS EVENT:</b></h2>
        <h3><b><i class="fa fa-clock-o w3-hover-opacity"></i> Thursday (2 Oct) 4pm to 9pm</b></h3>
        <!--h3><b>Weekly Time: <i class="fa fa-clock-o w3-hover-opacity"></i> Sundays 12pm to 5pm</b></h3-->
        <h3><b><a href="#location"><i class="fa fa-map-marker w3-hover-opacity"></i> Kennedy Seminar Room 2, University
              of Kent</a></b></h3>
      </div>
      <h4>Freshers Event Details</h4>
      <p class="w3-justify">Critical hit's Freshers Event is an upcoming event on Thursday, 2nd of October, 4pm to 9pm
        that's aimed towards
        University of Kent freshers (although all are still welcome). We will be aiming to introduce people to the world
        of competitive Super Smash Bros. Ultimate with a more relaxed bracket <i>PLUS</i> some more casual games such as
        Mario Kart. There will be FREE soft drinks available and we will be doing a group pizza order with Fireaway
        Pizza (this one will be paid). Come along to the Kennedy building of the Uni of Kent campus, Seminar Room 2 on
        the ground floor, and join us for a fun night!</p>
      <h4>About Us</h4>
      <p class="w3-justify">Critical Hit is Canterbury's most exciting weekly Super Smash Bros Ultimate tournament,
        bringing together players of all skill levels every Sunday from 12pm to 5pm. Whether you're a seasoned
        competitor looking to test your skills against the region's finest players, or a newcomer eager to learn the
        ropes in a welcoming community environment, Critical Hit provides the perfect platform to level up your game.
        Our tournaments feature both casual friendlies and competitive bracket play, with experienced players always
        willing to share knowledge and help newcomers improve their neutral game, combo execution, and tournament
        mentality.</p>
      <h4>The Team</h4>
      <div class="w3-row w3-padding-32">
        <div class="w3-third">
          <p>Tournament Organiser</p>
          <h3>Finn</h3>
          <img src="imgs/finn.png" class="w3-round w3-margin-bottom" alt="Finn"
            style="width:60%;max-width:200px;height:auto;">
        </div>
        <div class="w3-third">
          <p>Tournament Organiser</p>
          <h3>Effy</h3>
          <img src="imgs/effPic.jpg" class="w3-round w3-margin-bottom" alt="Effy"
            style="width:60%;max-width:200px;height:auto;">
        </div>
        <div class="w3-third">
          <p>Marketing Lead</p>
          <h3>Mat</h3>
          <img src="imgs/gh.png" class="w3-round" alt="Mat" style="width:60%;max-width:200px;height:auto;">
        </div>
      </div>
    </div>

    <!-- The Events Section -->
    <div class="w3-black" id="events">
      <div class="w3-container w3-content w3-padding-64" style="max-width:800px">
        <h2 class="w3-wide w3-center">UPCOMING EVENTS</h2>
        <p class="w3-opacity w3-center"><i>Join us for these special tournaments!</i></p><br>

        <ul class="w3-ul w3-border w3-white w3-text-grey" id="upcoming">
        </ul>
        <div class="w3-row-padding w3-padding-32" style="margin:0 -16px" id="registerEvents">
        </div>
      </div>
    </div>

    <!-- Ticket Modal>
  <div id="begin" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
      <header class="w3-container w3-teal w3-center w3-padding-32"> 
        <span onclick="document.getElementById('ticketModal').style.display='none'" 
       class="w3-button w3-teal w3-xlarge w3-display-topright">×</span>
        <h2 class="w3-wide"><i class="fa fa-gamepad w3-margin-right"></i>Tournament Entry</h2>
      </header>
      <div class="w3-container">
        <p><label><i class="fa fa-trophy"></i> Entry Fee: £5 per person</label></p>
        <input class="w3-input w3-border" type="text" placeholder="Number of setups needed?">
        <p><label><i class="fa fa-user"></i> Send To</label></p>
        <input class="w3-input w3-border" type="text" placeholder="Enter Discord username">
        <button class="w3-button w3-block w3-teal w3-padding-16 w3-section w3-right">REGISTER <i class="fa fa-check"></i></button>
        <button class="w3-button w3-red w3-section" onclick="document.getElementById('ticketModal').style.display='none'">Close <i class="fa fa-remove"></i></button>
        <p class="w3-right">Need <a href="#" class="w3-text-blue">help?</a></p>
      </div>
    </div>
  </div-->

    <!-- The Social Section -->
    <!--div class="w3-container w3-content w3-padding-64" style="max-width:800px" id="contact">
      <h2 class="w3-wide w3-center">Socials</h2>
      <p class="w3-opacity w3-center"><i>Check out our content!</i></p>
      <div class="w3-row w3-padding-32">
      <div class="w3-col m6 w3-large w3-margin-bottom">
        <i class="fa fa-map-marker" style="width:30px"></i> Canterbury, UK<br>
        <i class="fa fa-clock-o" style="width:30px"></i> Sundays: 12pm - 6pm<br>
        <i class="fa fa-envelope" style="width:30px"> </i> Email: info@criticalhit.uk<br>
      </div>
      <div class="w3-col m6">
        <form action="/action_page.php" target="_blank">
          <div class="w3-row-padding" style="margin:0 -16px 8px -16px">
            <div class="w3-half">
              <input class="w3-input w3-border" type="text" placeholder="Name" required name="Name">
            </div>
            <div class="w3-half">
              <input class="w3-input w3-border" type="text" placeholder="Email" required name="Email">
            </div>
          </div>
          <input class="w3-input w3-border" type="text" placeholder="Message" required name="Message">
          <button class="w3-button w3-black w3-section w3-right" type="submit">SEND</button>
        </form>
      </div>
    </div-->
    </div-->

    <!-- Image of location/map -->
    <div class="w3-container w3-content w3-padding-64" style="max-width:800px; text-align:center;" id="location">
      <h2 class="w3-wide w3-center">Location</h2>
      <div
        style="display: flex; justify-content: center; align-items: center; margin: 0px 0; font-size: large; color: blue">
        <a href="https://www.kent.ac.uk/maps/canterbury/canterbury-campus/building/kennedy/kensr2" class="w3-center">
          <i class="fa fa-map-marker w3-hover-opacity"></i> How to find Kennedy Seminar Room 2
        </a>
      </div>
      <div style="display: flex; justify-content: center; align-items: center; margin-top: 24px;">
        <iframe class="w3-center"
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2494.7153381917433!2d1.06307103904175!3d51.2979623964196!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47decb1f715cd725%3A0x313b4bb81723fad5!2sKennedy%20Building%2C%20School%20of%20Computing!5e0!3m2!1sen!2suk!4v1758896402198!5m2!1sen!2suk"
          width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </div>
  </div>
  <!--img src="imgs/kennedyLocation.png" class="w3-image w3-greyscale-min" style="width:100%"-->
  </div>
  <!-- End Page Content -->
  </div>

  <!-- Footer -->
  <footer class="w3-container w3-padding-64 w3-center w3-opacity w3-light-grey w3-xlarge">
    <a href="https://discord.gg/gWPcnnFFku" target="_blank">
      <img src="imgs/discord.png" style="width:4%;max-width:40px;min-width:40px;height:auto;">
    </a>
    <a href="https://www.twitch.tv/criticalhitsmash" target="_blank">
      <img src="imgs/twitch.png" style="width:3%;max-width:40px;min-width:40px;height:auto;">
    </a>
    <a href="https://www.youtube.com/@criticalhitsmash" target="_blank">
      <img src="imgs/youtube.png" style="width:4%;max-width:40px;min-width:40px;height:auto;">
    </a>
    <a href="https://www.instagram.com/criticalhitsmash" target="_blank">
      <img src="imgs/instagram.png" style="width:3%;max-width:40px;min-width:40px;height:auto;">
    </a>
    <a href="https://www.tiktok.com/@criticalhitsmash" target="_blank">
      <img src="imgs/tiktok.png" style="width:3%;max-width:40px;min-width:40px;height:auto;">
    </a>
    <p class="w3-medium">Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
  </footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <script defer>
    // defer so api content is fetched before display
    // Automatic Slideshow - change image every 4 seconds
    var myIndex = 0;
    carousel();

    function carousel() {
      var i;
      var x = document.getElementsByClassName("mySlides");
      for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";
      }
      myIndex++;
      if (myIndex > x.length) { myIndex = 1 }
      x[myIndex - 1].style.display = "block";
      setTimeout(carousel, 4000);
    }

    // Used to toggle the menu on small screens when clicking on the menu button
    function myFunction() {
      var x = document.getElementById("navDemo");
      if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
      } else {
        x.className = x.className.replace(" w3-show", "");
      }
    }

    // When the user clicks anywhere outside of the modal, close it
    var modal = document.getElementById('ticketModal');
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
    const startAPIURL = "https://api.start.gg/gql/alpha";
    const APIKey = "399eba98af3729199599242bbb02f247";


    //Conversts unix timestampt from api to a string in form of dd/mm/yyyy
    function timestampToDate(timestamp) {
      let date = new Date(timestamp * 1000)
      let dateString = date.getDate().toString().padStart(2, '0') + "/" + (date.getMonth() + 1).toString().padStart(2, '0') + "/" + date.getFullYear();
      return dateString;
    }

    //Convers unix timestampt from api to a string in form of DayOfWeek Date Month Year
    function timestampToDayDateMonthYear(timestamp) {
      let date = new Date(timestamp * 1000)
      let days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
      let months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
      let stringToReturn = days[date.getDay()] + " " + date.getDate().toString().padStart(2, '0') + " " + months[date.getMonth()] + " " + date.getFullYear();
      return stringToReturn;
    }

    //Filters the tournaments from query by key word, include keywords from future events in the array for them to be displayed
    function filterByNames(tournament) {
      let wantedTournaments = ["critical", "honeycomb", "melody"]
      let found = false
      wantedTournaments.forEach(name => {
        if (tournament.name.toLowerCase().includes(name)) {
          found = true
        }
      })
      return found
    }

    //Function that runs the query using the api and handles all usage of the api data on the page, including displaying
    //the list of upcoming events and the top 3 upcoming events with links to their registration pages
    const fetchStartGGData = () => {
      fetch(startAPIURL, {
        method: 'POST',
        headers: {
          'content-type': 'application/json',
          'Accept': 'application/json',
          Authorization: 'Bearer ' + APIKey
        },
        body: JSON.stringify({
          //Selects all upcoming tournaments and sorts them from soonest to latest
          //Will include all tournaments from canterbury, if there are more non us tournaments than the perPage variable, non of our tournaments will be displayed
          query: 'query canterburyTournaments($perPage: Int, $coordinates: String!, $radius: String!) { tournaments( query: {perPage: $perPage sortBy: "startAt asc" ,filter: {upcoming: true , location: {distanceFrom: $coordinates, distance: $radius}}} ) { nodes { id name city startAt slug } } }',
          variables: {
            //change perPage variable to increase the amount of upcoming tournaments shown in the upcoming list
            perPage: 20,
            //Coords of Canterbury
            coordinates: "51.2770, 1.0838",
            radius: "3mi"
          },
        })
      }).then(r => r.json())
        .then(data => {
          let tournaments = data.data.tournaments.nodes;
          /*
          //test tournament to ensure we filter out any other tournaments happening canterbury we don't want to display for now
          const testTournament = {
            id: 7428,
            name: "Test Tournament",
            city: "Birmingham",
            startAt: 1759057200,
            slug: "tournament/test-tournament-1"
          }
          tournaments.push(testTournament)
          */
          //Filters out unwanted tournaments if they are present
          tournaments = tournaments.filter(filterByNames)
          //For each loop to display the tournaments in the upcoming list
          tournaments.forEach(tournament => {
            let li = $("<li></li>").text(timestampToDate(tournament.startAt));
            li.addClass("w3-padding");
            let span = $("<span></span>").text(tournament.name)
            span.addClass("w3-tag w3-green w3-margin-left");
            li.append(span);
            $('#upcoming').append(li);
          });
          //For loop with a try catch statments to display the top 3 soonest tournaments with their registration pages
          //The catch ensures if there are not 3 upcoming tournaments a "Coming soon" tournament will be shown instead
          for (let i = 0; i < 3; i++) {
            try {
              //outer div with img, inner div, p with b, p, p, button
              let outerDiv = $("<div></div>")
              outerDiv.addClass("w3-third w3-margin-bottom")
              //What differes between honeycomb and criticalHit
              let image = "";
              let tourneyDesc = "";
              //Add more if else statements here if we want to display any more tournaments that arent ours
              if (tournaments[i].name.toLowerCase().includes("critical")) {
                image = '<img src= "imgs/criticalHitLogo.png" alt ="critHitLogo" style="width:100%" class ="w3-hover-opcacity">'
                tourneyDesc = "Weekly Local"
              }
              else if (tournaments[i].name.toLowerCase().includes("honeycomb")) {
                image = '<img src= "imgs/honeycombLogo.png" alt ="honeycombLogo" style="width:100%" class ="w3-hover-opcacity">'
                tourneyDesc = "Monthly Local"
              }
              else if (tournaments[i].name.toLowerCase().includes("melody")) {
                image = '<img src= "imgs/melodyLogo.png" alt ="melodyLogo" style="width:100%" class ="w3-hover-opcacity">'
                tourneyDesc = "Regional"

              }
              outerDiv.append(image)
              let innerDiv = $("<div></div")
              innerDiv.addClass("w3-container w3-white")
              innerDiv.append("<p><b>" + tournaments[i].name + "</b></p>")
              innerDiv.append('<p class ="w3-opacity">' + timestampToDayDateMonthYear(tournaments[i].startAt) + '</p>')
              innerDiv.append('<p>' + tourneyDesc + '</p>')
              let button = $('<button class = "w3-button w3-black w3-margin-bottom""> Register Now </button>')
              button.click(function () {
                window.open("https://www.start.gg/" + tournaments[i].slug + "/register");
              })
              innerDiv.append(button)
              outerDiv.append(innerDiv)
              $('#registerEvents').append(outerDiv);
            } catch (err) {
              $('#registerEvents').addClass('w3-flex')
              $('#registerEvents').css("justify-content", "center")
            }
          }
        })
    }
    fetchStartGGData()
  </script>

</body>

</html>
